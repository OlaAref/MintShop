<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
		xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
	<div th:replace="fragments/head :: head(${productName})"></div>
	<link th:href="@{/css/linkStyle.css}" media="all" rel="stylesheet" type="text/css" />
	<!-- star rating css -->
	<link th:href="@{/rating-star/css/star-rating.css}" media="all" rel="stylesheet" type="text/css" />
	<link th:href="@{/rating-star/themes/krajee-svg/theme.css}" media="all" rel="stylesheet" type="text/css" />

</head>
<body class="d-flex flex-column min-vh-100">

	
	<div th:replace="fragments/navbar :: navbar-content"></div>
	
	
	<div class="wrapper m-2 min-vh-100">
	
		<!-- Page Content  -->
        <div id="content">
        
        	<div th:if="${categoryParents != null && !categoryParents.empty}">
        		<div class="row m-2">
        			<div class="col">
        				
						<nav aria-label="breadcrumb">
						  <ol class="breadcrumb">
						    <li class="breadcrumb-item"><a th:href="@{/}">Home</a></li>
						    <th:block th:each="parent : ${categoryParents}">
						    	<li class="breadcrumb-item"><a th:href="@{'/c/'+${parent.alias}}">[[${parent.name}]]</a></li>
						    </th:block>
						    <li class="breadcrumb-item" th:if="${product != null}"><span>[[${product.shortName}]]</span></li>
						  </ol>
						</nav>
						
        			</div>
        		</div>
        	</div>
        	
        	
        	<div class="row">
        	
        		<div class="col-sm">
        			<div class="d-flex justify-content-center">
       					<img id="bigImage" th:if="${product.image} != null" th:src="@{${product.imagePath}}" width="60%" class="img-fluid" index="0"/>
						<i th:if="${product.image == null}" class="fas fa-image fa-5x" style="color: gray"></i>
					</div>
					<div class="row m-5">
						<div class="d-flex justify-content-center">
							<div class="border border-secondary p-1">
								<img class="image-thumbnail" th:if="${product.image} != null" th:src="@{${product.imagePath}}" height="50" index="0"/>
							</div>
							
							<th:block th:each="extraImage, status : ${product.images}">
								<div class="ms-2 border border-secondary p-1">
									<img class="image-thumbnail" th:if="${extraImage.extraImage} != null" th:src="@{${extraImage.extraImagePath}}" 
										height="50" style="max-width: 150px" th:index="${status.count}"/>
								</div>
							</th:block>
							
						</div>
					</div>
       			</div>
       			
       			<div class="col-sm">
       				<div>
       					<h2 th:text="${product.name}"></h2>
       				</div>
       				<div class="row">
       					<div class="col-auto">
       						<input class="rating-star" type="text" th:value="${product.averageRating}">
       					</div>
       					<div class="col-auto ml-1 mt-2">
       						<a href="#rating-section">[[${product.reviewCount}]] rating(s)</a>
       						|
       						<a href="#question-section">[[${product.answeredQuestions}]] answered question(s)</a>
       					</div>
       				</div>
       				<div>
       					<span>Brand : [[${product.brand.name}]]</span>
       				</div>
       				
       				<div th:replace="product/product-price :: product-price-details"></div>
       				
       				<div>&nbsp;</div>
       				<div th:utext="${product.shortDescription}"></div>
       			</div>
       			
       			<div class="col-sm-2">
       				<div>
       					<span th:if="${product.inStock}" class="text-success"><b>In Stock</b></span>
       					<span th:unless="${product.inStock}" class="text-danger"><b>Out Of Stock</b></span>
       				</div>
       				<th:block th:if="${product.inStock}">
	       				<div class="mt-2">
	       					<div th:replace="cart/quantity-control :: quantity-control(1, ${product.id})"></div>
	       				</div>
	       				
	       				<div class="mt-3">
	       					<input type="button" value="Add to cart" id="addToCartBtn" class="btn btn-primary">
	       				</div>
	       			</th:block>
       			</div>
       			
       			
        	</div>
        	
        	<div class="row">
        		<div class="col-12">
        			<div><hr></div>
        			<div class="m-2">
        				<h3 class="fw-bold">Product Description : </h3>
        			</div>
        			<div class="m-3" th:utext="${product.fullDescription}"></div>
        		</div>
        	</div>
        	
        	<div class="row">
        		<div class="col-12">
        			<div><hr></div>
        			<div class="m-2">
        				<h3 class="fw-bold">Product Details : </h3>
        			</div>
        			<div class="ms-5">
	        			<th:block th:each="detail : ${product.details}">
	        				<b>[[${detail.name}]]</b>: 
	        				<span>[[${detail.value}]]</span><br>
	        			</th:block>
        			</div>
        		</div>
        	</div>
        	
        	<div class="row">
        		<div class="col">
        			<hr/>
        		</div>
        	</div>
        	
        	<div class="row d-flex align-items-start" id="question-section">
        		
        		<div class="row m-1">
	        		<h3 class="fw-bold">Customer questions & answers </h3>
	        	</div>
        		
        		<th:block th:each="question : ${questions}">
        			<div th:replace="questions/question-fragments :: content"></div>
        		</th:block>
        		
        		<div th:unless="${#lists.isEmpty(questions)}">
	        		<div class="row mt-2">
	        			<div class="col-md-2 col-1"></div>
	        			<div class="col-auto ms-5">
	        				<a class="ms-3 all-reviews-link" th:href="@{'/question/all/'+${product.alias}+'/page/1?sortField=askedTime&sortDir=desc'}">
				  				See all questions <small>&gt;</small>
				  			</a>
	        			</div>
	        		</div>
        		</div>
        		
        		<!-- If the product does not have any question -->
        		<div th:if="${#lists.isEmpty(questions)}" class="ms-4">
        			<span class="">No Questions Founded.</span>
        		</div>
        		
        		<div th:replace="questions/question-fragments :: question-form"></div>
        		
        	</div>
        	
        	<div class="row">
        		<div class="col">
        			<hr/>
        		</div>
        	</div>
        	
        	<div class="row d-flex align-items-start" id="rating-section">
        		
        		<div class="row m-1">
	        		<h3 class="fw-bold">Customer Reviews</h3>
	        	</div>
        		
        		<th:block th:if="${product.reviewCount == 0}">
	  				<h5 class="fw-normal ms-4">No customer reviews</h5>
	  			</th:block>
        		
        		<div class="row m-1">
	        		<div class="col-auto">
	        			<div th:replace="reviews/review-rating :: ratingCard"></div>
	        		</div>
	        		
	        		<div class="col-auto">
	        			<th:block th:if="${product.reviewCount > 0}">
		        			<th:block th:each="review : ${reviews}">
		        				<div th:replace="reviews/review-rating :: reviewCard"></div>
				  			</th:block>
				  			
				  			<hr>
				  			<a class="ms-3 all-reviews-link" th:href="@{'/review/ratings/all/'+${product.alias}}">
				  				See all reviews <small>&gt;</small>
				  			</a>
			  			</th:block>
	        		</div>
        		</div>
        	</div>
        	
        </div>
		
	</div>
	
	<div th:replace="fragments/modal-dialog :: dialog"></div>
	
	<div style="height: 500px;" class="d-none d-xl-block d-lg-block" id="bodyExtender"></div>

	<div th:replace="fragments/image-carousel :: image-carousel"></div>

	<div th:replace="fragments/footer :: footer"></div>
	
	<!-- Start Scroll To Top Section -->
    <div class="scroll-top">
        <i class="fas fa-chevron-up fa-3x scroll-icon"></i>
    </div>
	
	
	<script th:src="@{/webjars/jquery/jquery.min.js}"></script>
	<script th:src="@{/webjars/popper.js/umd/popper.min.js}"></script>
	<script th:src="@{/webjars/font-awesome/js/all.min.js}"></script>
	<script th:src="@{/webjars/bootstrap/js/bootstrap.min.js}"></script>
	<script th:src="@{/js/plugins.js}"></script>
	<script th:src="@{/js/PNotify.js}"></script>
	<script th:src="@{/js/quantity-control.js}"></script>
	<script th:src="@{/js/add-to-cart.js}"></script>
	<script th:src="@{/js/jquery.number.min.js}"></script>
	<script th:src="@{/js/review-vote.js}"></script>
	<script th:src="@{/js/question-vote.js}"></script>
	<script th:src="@{/js/modals.js}"></script>
	
	<!-- star rating js -->
	<script th:src="@{/rating-star/js/star-rating.js}" type="text/javascript"></script>
	<script th:src="@{/rating-star/themes/krajee-svg/theme.js}" type="text/javascript"></script>
	
	<script>
		var contextPath = "[[@{/}]]";
		var productId = "[[${product.id}]]";
		var csrfHeaderName = "[[${_csrf.headerName}]]";
		var csrfValue = "[[${_csrf.token}]]";
		
		var decimalSeparator = "[[${DECIMAL_POINT_TYPE == 'COMMA' ? ',' : '.'}]]";
		var thousandSeparator = "[[${THOUSANDS_POINT_TYPE == 'COMMA' ? ',' : '.'}]]";
		
		$(document).ready(function() {
			var bigImage = $("#bigImage");
			
			$(".image-thumbnail").mouseover(function() {
				var currentImage = $(this).attr("src");
				var currentImageIndex = $(this).attr("index");
				
				bigImage.attr("src", currentImage);
				bigImage.attr("index", currentImageIndex);
			});
			
			bigImage.on("click", function() {
				$("#carouselModal").modal("show");
				var imageIndex = parseInt(bigImage.attr("index"));
				$("#carouselExampleIndicators").carousel(imageIndex);
			});
			
			$(".rating-star").rating({
				size: "sm",
				displayOnly: true,
				hoverOnClear: false,
				showCaption: false,
				theme: 'krajee-svg'
			});
			
			$(".rating-star-review").rating({
				size: "xs",
				displayOnly: true,
				hoverOnClear: false,
				showCaption: false,
				theme: 'krajee-svg'
			});
			
			formatRatingNumbers();
			
		});
		
		function formatRatingNumbers(){
			var ratingNumber = $("#ratingNumber").text();
			var formattedRating = $.number(ratingNumber, 2, decimalSeparator, thousandSeparator);
			$("#ratingNumber").text(formattedRating);
		}
		
	</script>
</body>
</html>